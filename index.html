<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>YsN MultiTV</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              background: '#09090b',
              surface: '#18181b',
              surfaceHighlight: '#27272a',
              primary: '#8b5cf6',
              primaryHover: '#7c3aed',
              accent: '#06b6d4',
              textMain: '#e4e4e7',
              textMuted: '#a1a1aa',
            }
          }
        }
      }
    </script>

    <style>
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: #09090b; }
      ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: #52525b; }
      .dragging { opacity: 0.5; border: 2px dashed #8b5cf6; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      
      @keyframes slideIn {
        from { transform: translateX(-100%); }
        to { transform: translateX(0); }
      }
      .slide-in-from-left { animation: slideIn 0.3s ease-out; }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
</head>
<body class="bg-background text-textMain h-screen overflow-hidden selection:bg-primary selection:text-white">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Tv, Settings, PanelLeftOpen, PanelLeftClose, Plus, RotateCcw, 
            Check, X, Youtube, MonitorPlay, Edit2, Trash2, Search, 
            GripVertical, AlertCircle 
        } from 'lucide-react';

        // --- Constants ---
        const DEFAULT_CHANNELS = [
            { id: 'ntv', title: 'NTV', url: 'https://www.youtube.com/watch?v=pqq5c6k70kk', type: 'youtube' },
            { id: 'cnn', title: 'CNN Türk', url: 'https://www.youtube.com/watch?v=6N8_r2uwLEc', type: 'youtube' },
            { id: 'haberturk', title: 'Habertürk', url: 'https://www.youtube.com/watch?v=RNVNlJSUFoE', type: 'youtube' },
            { id: 'sozcu', title: 'Sözcü TV', url: 'https://www.youtube.com/watch?v=ztmY_cCtUl0', type: 'youtube' },
            { id: 'halktv', title: 'Halk TV', url: 'https://www.youtube.com/watch?v=VBU0QX6brew', type: 'youtube' },
            { id: 'tele1', title: 'TELE 1', url: 'https://www.youtube.com/watch?v=elQyWeeDCYU', type: 'youtube' },
            { id: 'haberglobal', title: 'Haber Global', url: 'https://www.youtube.com/watch?v=EqoCJ8BPxtE', type: 'youtube' },
            { id: 'tv100', title: 'TV 100', url: 'https://www.youtube.com/watch?v=6g_DvD8e2T0', type: 'youtube' },
            { id: 'ekoltv', title: 'EKOL TV', url: 'https://ekoltv-live.ercdn.net/ekoltv/ekoltv.m3u8', type: 'hls' },
            { id: 'trthaber', title: 'TRT Haber', url: 'https://tv-trthaber.medya.trt.com.tr/master.m3u8', type: 'hls' },
            { id: 'tgrt', title: 'TGRT Haber', url: 'https://canli.tgrthaber.com/tgrt.m3u8', type: 'hls' },
            { id: 'cnbce', title: 'CNBC-e', url: 'https://www.youtube.com/watch?v=ziYwt0jF1p4', type: 'youtube' },
            { id: 'bloomberght', title: 'Bloomberg HT', url: 'https://tv.ensonhaber.com/bloomberght/bloomberght.m3u8', type: 'hls' },
            { id: 'ahaber', title: 'A Haber', url: 'https://www.youtube.com/watch?v=v3C8qJ0S4SI', type: 'youtube' },
            { id: '24tv', title: '24 TV', url: 'https://tv.ensonhaber.com/tv24/tv24.m3u8', type: 'hls' },
            { id: 'ulke', title: 'Ülke TV', url: 'https://mn-nl.mncdn.com/ulketv/ulketv.m3u8', type: 'hls' },
            { id: 'tvnet', title: 'TVNET', url: 'https://mn-nl.mncdn.com/tvnet/tvnet/playlist.m3u8', type: 'hls' },
            { id: 'benguturk', title: 'Bengütürk TV', url: 'https://tv.ensonhaber.com/benguturk/benguturk.m3u8', type: 'hls' },
            { id: 'ulusalkanal', title: 'Ulusal Kanal', url: 'https://www.youtube.com/watch?v=dK96AZbCns0', type: 'youtube' },
            { id: 'flashhaber', title: 'Flash Haber', url: 'https://flashhaber-live.ercdn.net/flashhaber/flashhaber.m3u8', type: 'hls' },
            { id: 'krt', title: 'KRT TV', url: 'https://www.youtube.com/watch?v=L4v5167wF_4', type: 'youtube' },
            { id: 'trtspor', title: 'TRT Spor', url: 'https://tv-trtspor1.medya.trt.com.tr/master.m3u8', type: 'hls' },
            { id: 'beinsports', title: 'beIN Sports Haber', url: 'https://www.youtube.com/watch?v=ovXYPBAzo-w', type: 'youtube' },
            { id: 'htspor', title: 'HT Spor', url: 'https://www.youtube.com/watch?v=RdpqsTbi_KU', type: 'youtube' },
            { id: 'aspor', title: 'A Spor', url: 'https://www.youtube.com/watch?v=hB9v9W4u_jE', type: 'youtube' },
            { id: 'sportsdigitale', title: 'Sports Digitale', url: 'https://www.youtube.com/watch?v=Fj8qZ4hZ8zY', type: 'youtube' },
            { id: 'fbtv', title: 'FB TV', url: 'https://www.youtube.com/watch?v=WBjYfR-V3r8', type: 'youtube' },
            { id: 'showtv', title: 'Show TV', url: 'https://www.youtube.com/watch?v=y3h2WJ0ZcNU', type: 'youtube' },
            { id: 'startv', title: 'Star TV', url: 'https://www.youtube.com/watch?v=M5yB8iE5b_0', type: 'youtube' },
            { id: 'kanald', title: 'Kanal D', url: 'https://www.youtube.com/watch?v=J32o-bB8c90', type: 'youtube' },
            { id: 'atv', title: 'ATV', url: 'https://www.youtube.com/watch?v=jW17rJ6hY40', type: 'youtube' },
            { id: 'nowtv', title: 'NOW (FOX)', url: 'https://www.youtube.com/watch?v=480ZzK-j6V0', type: 'youtube' },
            { id: 'kanal7', title: 'Kanal 7', url: 'https://kanal7-live.ercdn.net/kanal7/kanal7.m3u8', type: 'hls' },
            { id: 'tv8', title: 'TV 8', url: 'https://www.youtube.com/watch?v=DbpYcT4s3Yw', type: 'youtube' },
            { id: 'beyaztv', title: 'Beyaz TV', url: 'https://www.youtube.com/watch?v=A3y1Wz2tM78', type: 'youtube' },
            { id: '360tv', title: '360 TV', url: 'https://tv.ensonhaber.com/tv360/tv360.m3u8', type: 'hls' },
        ];

        // --- Utils ---
        const getYoutubeId = (url) => {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        };

        const isYoutubeUrl = (url) => url.includes('youtube.com') || url.includes('youtu.be');
        const isHlsUrl = (url) => url.includes('.m3u8');
        const normalizeUrl = (input) => {
            const trimmed = input.trim();
            if (trimmed.startsWith('<iframe')) {
                const srcMatch = trimmed.match(/src=["'](.*?)["']/);
                if (srcMatch && srcMatch[1]) return srcMatch[1];
            }
            return trimmed;
        };
        const generateId = () => Math.random().toString(36).substr(2, 9);

        // --- Components ---
        
        // Button
        const Button = ({ children, variant = 'primary', size = 'md', active = false, className = '', ...props }) => {
            const baseStyles = "inline-flex items-center justify-center rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background disabled:opacity-50 disabled:pointer-events-none";
            const variants = {
                primary: "bg-primary hover:bg-primaryHover text-white focus:ring-primary",
                secondary: "bg-surface hover:bg-surfaceHighlight text-textMain border border-surfaceHighlight focus:ring-zinc-500",
                danger: "bg-red-600 hover:bg-red-700 text-white focus:ring-red-500",
                ghost: "hover:bg-surfaceHighlight text-textMuted hover:text-white"
            };
            const sizes = {
                sm: "h-8 px-3 text-xs",
                md: "h-10 px-4 py-2 text-sm",
                lg: "h-12 px-6 text-base"
            };
            const activeStyle = active ? "ring-2 ring-primary ring-offset-2 ring-offset-background bg-primary text-white" : "";
            return <button className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${activeStyle} ${className}`} {...props}>{children}</button>;
        };

        // StreamFrame
        const StreamFrame = ({ stream, onRemove }) => {
            const videoRef = useRef(null);

            useEffect(() => {
                let hls;
                if (stream.type === 'hls' && videoRef.current) {
                    const video = videoRef.current;
                    if (window.Hls && window.Hls.isSupported()) {
                        hls = new window.Hls({ capLevelToPlayerSize: true, startLevel: -1, liveSyncDuration: 15 });
                        hls.loadSource(stream.url);
                        hls.attachMedia(video);
                        hls.on(window.Hls.Events.ERROR, (_event, data) => {
                           if (data.fatal) {
                              switch(data.type) {
                                case window.Hls.ErrorTypes.NETWORK_ERROR: hls.startLoad(); break;
                                case window.Hls.ErrorTypes.MEDIA_ERROR: hls.recoverMediaError(); break;
                                default: hls.destroy(); break;
                              }
                           }
                        });
                    } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
                        video.src = stream.url;
                    }
                }
                return () => { if (hls) hls.destroy(); };
            }, [stream]);

            const youtubeEmbedUrl = useMemo(() => {
                if (stream.type === 'youtube') {
                    const videoId = getYoutubeId(stream.url);
                    if (!videoId) return null;
                    // DÜZELTME 1: youtube-nocookie yerine normal youtube.com kullanıldı.
                    return `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1`;
                }
                return null;
            }, [stream.url, stream.type]);

            const renderContent = () => {
                if (stream.type === 'youtube') {
                    if (!youtubeEmbedUrl) return <div className="w-full h-full bg-zinc-900 flex flex-col items-center justify-center text-zinc-500 border border-zinc-800 rounded-lg relative"><button onClick={onRemove} className="absolute top-2 right-2 bg-black/50 hover:bg-red-600 text-white p-1 rounded-md transition-colors z-20"><X className="w-4 h-4" /></button><AlertCircle className="w-10 h-10 mb-2" /><p className="text-sm">Bağlantı Hatası</p></div>;
                    // DÜZELTME 2: referrerPolicy="no-referrer" kaldırıldı, yerine "strict-origin-when-cross-origin" eklendi.
                    return <iframe src={youtubeEmbedUrl} className="w-full h-full" title={stream.title} frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen loading="lazy" referrerPolicy="strict-origin-when-cross-origin" />;
                }
                if (stream.type === 'hls') return <video ref={videoRef} className="w-full h-full object-contain bg-black" controls autoPlay muted playsInline />;
                // DÜZELTME 3: Genel iframe'ler için de referrerPolicy düzeltildi.
                return <iframe src={stream.url} className="w-full h-full" title={stream.title} frameBorder="0" allowFullScreen referrerPolicy="strict-origin-when-cross-origin" />;
            };

            return (
                <div className="w-full h-full relative group bg-black rounded-lg overflow-hidden border border-surfaceHighlight shadow-lg">
                    <button onClick={onRemove} className="absolute top-2 right-2 bg-black/60 hover:bg-red-600 backdrop-blur-sm text-white p-1.5 rounded-md opacity-0 group-hover:opacity-100 transition-all z-50 hover:scale-110" title="Kapat"><X className="w-4 h-4" /></button>
                    <div className="absolute top-0 left-0 w-full h-12 bg-gradient-to-b from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none"><p className="text-white text-xs font-semibold truncate px-3 py-2">{stream.title}</p></div>
                    {renderContent()}
                </div>
            );
        };

        // StreamGrid
        const StreamGrid = ({ streams, assignments, gridSize, onDrop, onRemove }) => {
            const getGridClass = (size) => {
                switch (size) {
                    case 1: return "grid-cols-1 grid-rows-1";
                    case 4: return "grid-cols-2 grid-rows-2";
                    case 8: return "grid-cols-4 grid-rows-4"; 
                    case 9: return "grid-cols-3 grid-rows-3";
                    case 16: return "grid-cols-4 grid-rows-4";
                    case 20: return "grid-cols-4 md:grid-cols-5 grid-rows-4";
                    case 25: return "grid-cols-5 grid-rows-5";
                    default: return "grid-cols-2";
                }
            };
            const handleDragOver = (e) => { e.preventDefault(); e.currentTarget.classList.add('bg-primary/20', 'border-primary'); };
            const handleDragLeave = (e) => { e.currentTarget.classList.remove('bg-primary/20', 'border-primary'); };
            const slots = Array.from({ length: gridSize });

            return (
                <div className={`w-full h-full grid gap-2 p-2 overflow-hidden ${getGridClass(gridSize)}`}>
                    {slots.map((_, index) => {
                        const streamId = assignments[index];
                        const stream = streams.find(s => s.id === streamId);
                        let spanClass = "";
                        if (gridSize === 8) { if (index === 0) spanClass = "col-span-3 row-span-3"; else spanClass = "col-span-1 row-span-1"; }

                        return (
                            <div key={index} className={`w-full h-full min-h-0 bg-zinc-950/50 rounded-xl overflow-hidden border-2 border-dashed border-zinc-800 transition-all duration-200 relative ${spanClass}`} onDragOver={handleDragOver} onDragLeave={handleDragLeave} onDrop={(e) => { handleDragLeave(e); onDrop(e, index); }}>
                                {stream ? (
                                    <div className="w-full h-full border-none"><div className="absolute inset-0 z-0"><StreamFrame stream={stream} onRemove={() => onRemove(index)} /></div></div>
                                ) : (
                                    <div className="w-full h-full flex flex-col items-center justify-center text-zinc-700 pointer-events-none">
                                        <Plus className={`mb-2 opacity-50 ${gridSize === 8 && index === 0 ? "w-16 h-16" : "w-8 h-8"}`} />
                                        <span className="text-xs font-semibold uppercase tracking-widest opacity-50">Kanal Sürükle</span>
                                        <span className="absolute bottom-2 right-3 text-4xl font-black text-zinc-800/50 select-none">{index + 1}</span>
                                    </div>
                                )}
                            </div>
                        );
                    })}
                </div>
            );
        };

        // Sidebar
        const Sidebar = ({ streams, onDragStart, isOpen }) => {
            const [searchTerm, setSearchTerm] = useState('');
            if (!isOpen) return null;
            const filteredStreams = streams.filter(s => s.title.toLowerCase().includes(searchTerm.toLowerCase()));
            return (
                <div className="flex flex-col h-full bg-surface border-r border-surfaceHighlight w-64 flex-shrink-0 animate-in slide-in-from-left duration-300">
                    <div className="p-4 border-b border-surfaceHighlight">
                        <h2 className="text-sm font-bold text-textMuted uppercase tracking-wider mb-3">Kanallar</h2>
                        <div className="relative">
                            <Search className="absolute left-2.5 top-2.5 w-4 h-4 text-textMuted" />
                            <input type="text" placeholder="Kanal ara..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full bg-surfaceHighlight text-sm text-white rounded-lg pl-9 pr-3 py-2 focus:ring-1 focus:ring-primary focus:outline-none placeholder:text-zinc-600" />
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto p-2 space-y-1">
                        {filteredStreams.map(stream => (
                            <div key={stream.id} draggable onDragStart={(e) => onDragStart(e, stream.id)} className="group flex items-center gap-3 p-3 rounded-lg hover:bg-surfaceHighlight cursor-grab active:cursor-grabbing transition-colors border border-transparent hover:border-surfaceHighlight/50">
                                <GripVertical className="w-4 h-4 text-zinc-600 group-hover:text-zinc-400" />
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center bg-zinc-900 ${stream.type === 'youtube' ? 'text-red-500' : 'text-primary'}`}>
                                    {stream.type === 'youtube' ? <Youtube className="w-4 h-4" /> : <MonitorPlay className="w-4 h-4" />}
                                </div>
                                <div className="min-w-0"><p className="text-sm font-medium text-zinc-200 truncate">{stream.title}</p><p className="text-[10px] text-zinc-500 truncate">Sürükle bırak</p></div>
                            </div>
                        ))}
                        {filteredStreams.length === 0 && <div className="text-center py-8 text-xs text-zinc-600">Kanal bulunamadı.</div>}
                    </div>
                </div>
            );
        };

        // SettingsModal
        const SettingsModal = ({ streams, setStreams, onClose }) => {
            const [newUrl, setNewUrl] = useState('');
            const [newTitle, setNewTitle] = useState('');
            const [editingId, setEditingId] = useState(null);
            const [editTitle, setEditTitle] = useState('');
            const [editUrl, setEditUrl] = useState('');

            const handleAddStream = () => {
                if (!newUrl) return;
                const processedUrl = normalizeUrl(newUrl);
                let type = 'web';
                if (isYoutubeUrl(processedUrl)) type = 'youtube';
                else if (isHlsUrl(processedUrl)) type = 'hls';
                const title = newTitle || `Yayın ${streams.length + 1}`;
                const newStream = { id: generateId(), url: processedUrl, title, type };
                setStreams([...streams, newStream]);
                setNewUrl(''); setNewTitle('');
            };

            const handleDelete = (e, id) => { e.preventDefault(); e.stopPropagation(); if (editingId === id) setEditingId(null); if(window.confirm('Bu kanalı silmek istediğinize emin misiniz?')) { setStreams(streams.filter(s => s.id !== id)); } };
            const handleEditClick = (e, stream) => { e.preventDefault(); e.stopPropagation(); setEditingId(stream.id); setEditTitle(stream.title); setEditUrl(stream.url); };
            const handleCancelEdit = (e) => { if (e) { e.preventDefault(); e.stopPropagation(); } setEditingId(null); setEditTitle(''); setEditUrl(''); };
            const handleSaveEdit = (e) => { e.preventDefault(); e.stopPropagation(); if (!editingId || !editUrl) return; const processedUrl = normalizeUrl(editUrl); let type = 'web'; if (isYoutubeUrl(processedUrl)) type = 'youtube'; else if (isHlsUrl(processedUrl)) type = 'hls'; const updatedStreams = streams.map(stream => { if (stream.id === editingId) { return { ...stream, title: editTitle || stream.title, url: processedUrl, type }; } return stream; }); setStreams(updatedStreams); handleCancelEdit(); };
            const loadTurkishChannels = () => { if(window.confirm('Mevcut listeniz silinecek ve varsayılan Türk kanalları yüklenecektir. Onaylıyor musunuz?')) { setStreams(DEFAULT_CHANNELS); } };

            return (
                <div className="fixed inset-0 z-50 bg-background/95 backdrop-blur-md flex items-center justify-center p-4">
                    <div className="bg-surface w-full max-w-4xl h-[85vh] rounded-2xl border border-surfaceHighlight shadow-2xl overflow-hidden flex flex-col">
                        <div className="p-6 border-b border-surfaceHighlight flex justify-between items-center bg-zinc-900/50"><div><h2 className="text-2xl font-bold text-white tracking-tight">Kanal Yönetimi</h2><p className="text-textMuted text-sm">Listeye yeni yayınlar ekleyin veya mevcutları düzenleyin.</p></div><Button onClick={onClose} variant="primary">Tamamla</Button></div>
                        <div className="flex-1 overflow-y-auto p-6">
                            <div className="bg-zinc-900/50 p-6 rounded-xl border border-dashed border-zinc-700 mb-8"><h3 className="text-sm font-bold text-indigo-400 uppercase tracking-wider mb-4 flex items-center gap-2"><Plus className="w-4 h-4" /> Yeni Kanal Ekle</h3><div className="grid grid-cols-1 md:grid-cols-12 gap-4"><div className="md:col-span-4"><input type="text" className="w-full bg-black/50 border border-zinc-700 rounded-lg px-3 py-2 text-white focus:ring-1 focus:ring-primary focus:border-primary focus:outline-none placeholder:text-zinc-600" placeholder="Başlık (Opsiyonel)" value={newTitle} onChange={(e) => setNewTitle(e.target.value)} /></div><div className="md:col-span-6"><input type="text" className="w-full bg-black/50 border border-zinc-700 rounded-lg px-3 py-2 text-white focus:ring-1 focus:ring-primary focus:border-primary focus:outline-none placeholder:text-zinc-600" placeholder="YouTube Linki, Iframe Kodu veya m3u8..." value={newUrl} onChange={(e) => setNewUrl(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleAddStream()} /></div><div className="md:col-span-2"><Button onClick={handleAddStream} className="w-full h-[42px]" disabled={!newUrl}>Ekle</Button></div></div><p className="text-xs text-zinc-500 mt-2">İpucu: YouTube'dan "Paylaş &gt; Yerleştir" kodunu olduğu gibi buraya yapıştırabilirsiniz.</p></div>
                            <div className="space-y-4"><div className="flex justify-between items-center mb-2"><h3 className="text-lg font-semibold text-textMain">Kayıtlı Kanallar ({streams.length})</h3><Button size="sm" variant="secondary" onClick={loadTurkishChannels}><RotateCcw className="w-4 h-4 mr-2" /> Türk Kanallarını Yükle</Button></div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">{streams.map((stream) => { const isEditing = editingId === stream.id; return (<div key={stream.id} className={`bg-surfaceHighlight p-3 rounded-lg flex items-center gap-3 border transition-colors group ${isEditing ? 'border-primary ring-1 ring-primary' : 'border-transparent hover:border-zinc-600'}`}>{!isEditing && (<div className={`w-10 h-10 rounded-full flex items-center justify-center bg-black/40 flex-shrink-0 ${stream.type === 'youtube' ? 'text-red-500' : stream.type === 'hls' ? 'text-green-500' : 'text-primary'}`}>{stream.type === 'youtube' ? <Youtube className="w-5 h-5" /> : <MonitorPlay className="w-5 h-5" />}</div>)}<div className="flex-1 min-w-0">{isEditing ? (<div className="space-y-2"><input type="text" value={editTitle} onChange={(e) => setEditTitle(e.target.value)} className="w-full bg-black/50 border border-zinc-700 rounded px-2 py-1 text-sm text-white focus:border-primary focus:outline-none" placeholder="Kanal Başlığı" /><input type="text" value={editUrl} onChange={(e) => setEditUrl(e.target.value)} className="w-full bg-black/50 border border-zinc-700 rounded px-2 py-1 text-xs text-zinc-300 focus:border-primary focus:outline-none font-mono" placeholder="Kanal Linki" /></div>) : (<><div className="flex items-center gap-2"><h4 className="font-medium text-zinc-200 truncate text-sm">{stream.title}</h4>{stream.type === 'hls' && <span className="text-[10px] bg-green-900/50 text-green-400 px-1.5 rounded">HLS</span>}</div><p className="text-xs text-zinc-500 truncate">{stream.url}</p></>)}</div><div className="flex items-center gap-1">{isEditing ? (<><Button variant="primary" size="sm" onClick={handleSaveEdit} className="h-8 w-8 p-0" title="Kaydet"><Check className="w-4 h-4" /></Button><Button variant="secondary" size="sm" onClick={handleCancelEdit} className="h-8 w-8 p-0 text-red-400 hover:text-red-300" title="İptal"><X className="w-4 h-4" /></Button></>) : (<><Button variant="ghost" size="sm" onClick={(e) => handleEditClick(e, stream)} className="text-zinc-500 hover:text-primary h-8 w-8 p-0" title="Düzenle"><Edit2 className="w-4 h-4" /></Button><Button variant="ghost" size="sm" onClick={(e) => handleDelete(e, stream.id)} className="text-zinc-500 hover:text-red-400 h-8 w-8 p-0" title="Sil"><Trash2 className="w-4 h-4" /></Button></>)}</div></div>); })}</div></div>
                        </div>
                    </div>
                </div>
            );
        };

        // App
        const App = () => {
            const [streams, setStreams] = useState(() => { try { const saved = localStorage.getItem('ysn_streams'); return saved ? JSON.parse(saved) : DEFAULT_CHANNELS; } catch { return DEFAULT_CHANNELS; } });
            const [assignments, setAssignments] = useState(() => { try { const saved = localStorage.getItem('ysn_assignments'); return saved ? JSON.parse(saved) : {}; } catch { return {}; } });
            const [gridSize, setGridSize] = useState(() => { try { const saved = localStorage.getItem('ysn_grid_pref'); const parsed = saved ? Number(saved) : 4; const validSizes = [1, 4, 8, 9, 16, 20, 25]; return validSizes.includes(parsed) ? parsed : 4; } catch { return 4; } });
            const [showSettings, setShowSettings] = useState(false);
            const [sidebarOpen, setSidebarOpen] = useState(true);

            useEffect(() => { localStorage.setItem('ysn_streams', JSON.stringify(streams)); }, [streams]);
            useEffect(() => { localStorage.setItem('ysn_assignments', JSON.stringify(assignments)); }, [assignments]);
            useEffect(() => { localStorage.setItem('ysn_grid_pref', String(gridSize)); }, [gridSize]);
            useEffect(() => { const validIds = new Set(streams.map(s => s.id)); let changed = false; const newAssignments = { ...assignments }; Object.keys(newAssignments).forEach((key) => { const index = Number(key); if (!validIds.has(newAssignments[index])) { delete newAssignments[index]; changed = true; } }); if (changed) setAssignments(newAssignments); }, [streams]);

            const handleDragStart = (e, streamId) => { e.dataTransfer.setData('streamId', streamId); e.dataTransfer.effectAllowed = 'copy'; };
            const handleDrop = (e, slotIndex) => { const streamId = e.dataTransfer.getData('streamId'); if (streamId) { setAssignments(prev => ({ ...prev, [slotIndex]: streamId })); } };
            const handleRemoveFromSlot = (slotIndex) => { setAssignments(prev => { const next = { ...prev }; delete next[slotIndex]; return next; }); };
            const gridOptions = [1, 4, 8, 9, 16, 20, 25];

            return (
                <div className="flex flex-col h-screen bg-background text-textMain font-sans">
                    <header className="h-14 flex items-center justify-between px-4 border-b border-surfaceHighlight bg-surface z-40 flex-shrink-0">
                        <div className="flex items-center gap-3">
                            <Button variant="ghost" size="sm" className="p-1.5 mr-1 hidden md:flex text-zinc-400 hover:text-white" onClick={() => setSidebarOpen(!sidebarOpen)} title={sidebarOpen ? "Kenar Çubuğunu Gizle" : "Kenar Çubuğunu Göster"}>
                                {sidebarOpen ? <PanelLeftClose className="w-5 h-5" /> : <PanelLeftOpen className="w-5 h-5" />}
                            </Button>
                            <div className="bg-gradient-to-br from-primary to-indigo-600 p-1.5 rounded-lg shadow-lg shadow-primary/20"><Tv className="w-5 h-5 text-white" /></div>
                            <span className="text-lg font-bold tracking-tight text-white hidden sm:inline"><span className="text-primary">YsN</span> MultiTv</span>
                        </div>
                        <div className="flex items-center gap-1 overflow-x-auto no-scrollbar mx-4 mask-fade">{gridOptions.map((size) => (<button key={size} onClick={() => setGridSize(size)} className={`min-w-[32px] h-8 rounded-md flex items-center justify-center text-xs font-bold transition-all border ${gridSize === size ? 'bg-primary border-primary text-white shadow-[0_0_10px_rgba(124,58,237,0.4)]' : 'bg-surfaceHighlight border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-500'}`}>{size}</button>))}</div>
                        <div className="flex items-center gap-2">
                             <button onClick={() => setSidebarOpen(!sidebarOpen)} className="md:hidden p-2 text-zinc-400 hover:text-white">{sidebarOpen ? <PanelLeftClose /> : <PanelLeftOpen />}</button>
                             <Button variant="secondary" size="sm" onClick={() => setShowSettings(true)}><Settings className="w-4 h-4 md:mr-2" /><span className="hidden md:inline">Yönet</span></Button>
                        </div>
                    </header>
                    <div className="flex flex-grow overflow-hidden">
                        <div className={`hidden md:block transition-all duration-300 ease-in-out ${sidebarOpen ? 'w-64' : 'w-0'} overflow-hidden`}><div className="w-64 h-full"><Sidebar streams={streams} onDragStart={handleDragStart} isOpen={sidebarOpen} /></div></div>
                        {sidebarOpen && (<div className="fixed inset-0 z-30 bg-black/50 md:hidden" onClick={() => setSidebarOpen(false)}><div className="absolute left-0 top-14 bottom-0 w-64 bg-surface shadow-xl" onClick={e => e.stopPropagation()}><Sidebar streams={streams} onDragStart={handleDragStart} isOpen={true} /></div></div>)}
                        <main className="flex-grow bg-background relative p-2 md:p-4 overflow-hidden"><div className="w-full h-full max-w-[1920px] mx-auto bg-surface/30 rounded-2xl border border-surfaceHighlight/50 shadow-2xl backdrop-blur-sm"><StreamGrid streams={streams} assignments={assignments} gridSize={gridSize} onDrop={handleDrop} onRemove={handleRemoveFromSlot} /></div></main>
                    </div>
                    {showSettings && <SettingsModal streams={streams} setStreams={setStreams} onClose={() => setShowSettings(false)} />}
                </div>
            );
        };

        const rootElement = document.getElementById('root');
        if (rootElement) {
            const root = createRoot(rootElement);
            root.render(<App />);
        }
    </script>
</body>
</html>